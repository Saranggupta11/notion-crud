import Head from "next/head";
import { Client } from "@notionhq/client";
import { Button, TextField } from "@mui/material";

const userData = (content) => {
  return {
    parent: {
      database_id: process.env.NEXT_PUBLIC_NOTION_DB,
    },
    properties: {
      title: {
        title: [
          {
            text: {
              content,
            },
          },
        ],
      },
      Description: {
        rich_text: [
          {
            text: {
              content,
            },
          },
        ],
      },
      Project: {
        checkbox: true,
      },
      Votes: {
        number: 100,
      },
    },
  };
};

const updateData = (content) => {
  return {
    page_id: "dd9a896e-dbfc-4350-8289-ae044b4005b1",
    archived: false,
    properties: {
      title: {
        title: [
          {
            text: {
              content,
            },
          },
        ],
      },
      Description: {
        rich_text: [
          {
            text: {
              content,
            },
          },
        ],
      },
      Project: {
        checkbox: true,
      },
      Votes: {
        number: 20,
      },
    },
  };
};
const deleteData = (content) => {
  return {
    page_id: "0af96728-6392-4b25-a043-fc8f93c25e69",
    archived: true,
    properties: {
      title: {
        title: [
          {
            text: {
              content,
            },
          },
        ],
      },
      Description: {
        rich_text: [
          {
            text: {
              content,
            },
          },
        ],
      },
      Project: {
        checkbox: true,
      },
      Votes: {
        number: 20,
      },
    },
  };
};

export default function Home({ project }) {
  const createSuggestion = async () => {
    await fetch("/api/hello", {
      method: "POST",
      body: JSON.stringify(userData("naya suggestion banaya hai")),
    });
  };
  const updateSuggestion = async () => {
    await fetch("/api/update", {
      method: "PATCH",
      body: JSON.stringify(updateData("suggestion")),
    });
  };
  const deleteSuggestion = async () => {
    await fetch("/api/update", {
      method: "DELETE",
      body: JSON.stringify(deleteData("suggestion deleted")),
    });
  };
  console.log(project);

  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <div className="p-6">
          <div className="flex flex-col">
            <TextField
              id="outlined-basic"
              label="Outlined"
              variant="outlined"
            />
            <TextField
              id="outlined-basic"
              label="Outlined"
              variant="outlined"
            />
            <TextField
              id="outlined-basic"
              label="Outlined"
              variant="outlined"
            />
          </div>
          <div className="p-6 flex gap-4">
            <Button variant="outlined" onClick={createSuggestion}>
              create new suggestion
            </Button>
            <Button variant="outlined" onClick={updateSuggestion}>
              update suggestion
            </Button>
            <Button variant="outlined" onClick={deleteSuggestion}>
              delete suggestion
            </Button>
          </div>
          <div>
            {project.map((item) => (
              <p key={item.id}>{item.properties.Title.title[0].text.content}</p>
            ))}
          </div>
        </div>
      </main>
    </div>
  );
}

export async function getStaticProps() {
  const notion = new Client({
    auth: process.env.NEXT_PUBLIC_NOTION_API_KEY,
  });
  const res = await notion.databases.query({
    database_id: process.env.NEXT_PUBLIC_NOTION_DB,
  });
  return {
    props: {
      project: res.results,
    },
  };
}
